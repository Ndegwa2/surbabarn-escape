<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maid Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #007bff;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        .logout-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        .date-shift {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .date-shift h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .shift-hours {
            font-size: 16px;
            color: #666;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .card.rooms-to-clean {
            border-top: 5px solid #dc3545;
        }

        .card.in-progress {
            border-top: 5px solid #fd7e14;
        }

        .card.completed {
            border-top: 5px solid #28a745;
        }

        .card-number {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }

        .card-label {
            font-size: 14px;
            color: #666;
        }

        .tabs {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }

        .tab-button {
            padding: 10px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .room-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .room-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .room-info {
            flex: 1;
        }

        .room-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .guest-status {
            font-size: 14px;
            color: #666;
        }

        .priority-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .priority-high {
            background-color: #dc3545;
            color: white;
        }

        .priority-medium {
            background-color: #ffc107;
            color: #212529;
        }

        .status-toggle {
            display: flex;
            gap: 5px;
        }

        .status-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .status-dirty {
            background-color: #dc3545;
            color: white;
        }

        .status-cleaning {
            background-color: #fd7e14;
            color: white;
        }

        .status-ready {
            background-color: #28a745;
            color: white;
        }

        .checklist-btn {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group select,
        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }

        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            width: 100%;
        }

        .btn:hover {
            background-color: #0069d9;
        }

        .supply-btn {
            padding: 15px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
            width: 100%;
            text-align: left;
        }

        .supply-btn:hover {
            background-color: #5a6268;
        }

        .clock-btn {
            padding: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
            width: 100%;
        }

        .clock-btn.clock-out {
            background-color: #dc3545;
        }

        .shift-summary {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .close {
            float: right;
            cursor: pointer;
            font-size: 24px;
        }

        .modal h2 {
            margin-bottom: 20px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }

        .checklist-item input {
            margin-right: 10px;
        }

        .checklist-item label {
            flex: 1;
        }

        .checklist-item.completed {
            background-color: #d4edda;
        }

        .checklist-item.completed label {
            text-decoration: line-through;
            color: #28a745;
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 12px;
        }

        .nav-item.active {
            color: #007bff;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 3px;
        }

        @media (max-width: 768px) {
            body {
                padding-bottom: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Maid Dashboard</h1>
        <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>

    <div class="date-shift">
        <h2 id="currentDate">Loading...</h2>
        <div class="shift-hours">Shift: <span id="shiftStart">08:00 AM</span> - <span id="shiftEnd">04:00 PM</span></div>
    </div>

    <div class="summary-cards">
        <div class="card rooms-to-clean">
            <div class="card-number" id="roomsToClean">0</div>
            <div class="card-label">Rooms to Clean</div>
        </div>
        <div class="card in-progress">
            <div class="card-number" id="inProgress">0</div>
            <div class="card-label">In Progress</div>
        </div>
        <div class="card completed">
            <div class="card-number" id="completed">0</div>
            <div class="card-label">Completed</div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="my-tasks">üõèÔ∏è My Tasks</button>
            <button class="tab-button" data-tab="report-issues">üõ†Ô∏è Report Issues</button>
            <button class="tab-button" data-tab="supplies">üì¶ Supplies</button>
            <button class="tab-button" data-tab="shift-log">‚è±Ô∏è Shift Log</button>
        </div>

        <div id="my-tasks" class="tab-content active">
            <h3>My Assigned Tasks</h3>
            <table id="housekeepingTasksTable">
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Status</th>
                        <th>Assigned Date</th>
                        <th>Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tasks will be populated here -->
                </tbody>
            </table>
            
            <h3 style="margin-top: 20px;">Other Dirty Rooms</h3>
            <div class="room-list" id="roomList">
                <!-- Room items will be populated here -->
            </div>
        </div>

        <div id="report-issues" class="tab-content">
            <form id="issueForm">
                <div class="form-group">
                    <label for="issueRoom">Select Room</label>
                    <select id="issueRoom" required>
                        <option value="">Select a room</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issueDescription">Problem Description</label>
                    <textarea id="issueDescription" rows="4" placeholder="Describe the issue..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="issuePhoto">Upload Photo (optional)</label>
                    <input type="file" id="issuePhoto" accept="image/*">
                </div>
                <button type="submit" class="btn">Send to Manager</button>
            </form>
        </div>

        <div id="supplies" class="tab-content">
            <h3>Request Supplies</h3>
            <form id="supplyForm">
                <div class="form-group">
                    <label for="supplyItem">Select Item</label>
                    <select id="supplyItem" required>
                        <option value="">Select an item</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supplyQuantity">Quantity</label>
                    <input type="number" id="supplyQuantity" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="supplyReason">Reason</label>
                    <textarea id="supplyReason" rows="3" placeholder="Why do you need these supplies?"></textarea>
                </div>
                <button type="submit" class="btn">Request Supplies</button>
            </form>
            
            <h3 style="margin-top: 20px;">Quick Requests</h3>
            <button class="supply-btn" onclick="requestSupply('towels')">Request More Towels</button>
            <button class="supply-btn" onclick="requestSupply('soap')">Request More Soap</button>
            <button class="supply-btn" onclick="requestSupply('cleaning')">Request Cleaning Supplies</button>
            
            <h3 style="margin-top: 20px;">My Supply Requests</h3>
            <table id="supplyRequestsTable">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Supply requests will be populated here -->
                </tbody>
            </table>
        </div>

        <div id="shift-log" class="tab-content">
            <button class="clock-btn" id="clockInBtn">Clock In</button>
            <button class="clock-btn clock-out" id="clockOutBtn">Clock Out</button>
            <div class="shift-summary">
                <h3>Today's Summary</h3>
                <p>Rooms Cleaned: <span id="roomsCleaned">0</span></p>
                <p>Issues Reported: <span id="issuesReported">0</span></p>
            </div>
        </div>
    </div>

    <!-- Cleaning Checklist Modal -->
    <div class="modal" id="checklistModal">
        <div class="modal-content">
            <span class="close" id="closeChecklistModal">&times;</span>
            <h2>Cleaning Checklist - Room <span id="checklistRoomNumber"></span></h2>
            <form id="checklistForm">
                <div class="checklist-item">
                    <input type="checkbox" id="task1" name="task1">
                    <label for="task1">Change bed linens</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="task2" name="task2">
                    <label for="task2">Replace towels</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="task3" name="task3">
                    <label for="task3">Refill toiletries</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="task4" name="task4">
                    <label for="task4">Empty trash</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="task5" name="task5">
                    <label for="task5">Vacuum/mop floor</label>
                </div>
                <button type="submit" class="btn">Submit & Mark as Ready</button>
            </form>
        </div>
    </div>

    <!-- Bottom Navigation Bar -->
    <div class="nav-bar">
        <a href="#" class="nav-item active" data-tab="my-tasks">
            <i>üõèÔ∏è</i>
            <span>Tasks</span>
        </a>
        <a href="#" class="nav-item" data-tab="report-issues">
            <i>üõ†Ô∏è</i>
            <span>Issues</span>
        </a>
        <a href="#" class="nav-item" data-tab="supplies">
            <i>üì¶</i>
            <span>Supplies</span>
        </a>
        <a href="#" class="nav-item" data-tab="shift-log">
            <i>‚è±Ô∏è</i>
            <span>Shift</span>
        </a>
    </div>

    <!-- Maintenance Modal -->
    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <span class="close" id="closeMaintenanceModal">&times;</span>
            <h2>Report Maintenance Issue</h2>
            <form id="maintenanceForm">
                <div class="form-group">
                    <label for="maintenanceRoom">Room Number</label>
                    <select id="maintenanceRoom" required>
                        <option value="">Select a room</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="maintenanceIssue">Issue Description</label>
                    <textarea id="maintenanceIssue" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn btn-block">Submit Report</button>
            </form>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="modal" id="inventoryModal">
        <div class="modal-content">
            <span class="close" id="closeInventoryModal">&times;</span>
            <h2>Request Inventory</h2>
            <form id="inventoryForm">
                <div class="form-group">
                    <label for="inventoryItem">Item</label>
                    <select id="inventoryItem" required>
                        <option value="">Select an item</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inventoryQuantity">Quantity</label>
                    <input type="number" id="inventoryQuantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="inventoryReason">Reason</label>
                    <textarea id="inventoryReason" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-block">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- Issue Modal -->
    <div class="modal" id="issueModal">
        <div class="modal-content">
            <span class="close" id="closeIssueModal">&times;</span>
            <h2>Report Lost/Damaged Item</h2>
            <form id="issueForm">
                <div class="form-group">
                    <label for="issueItem">Item</label>
                    <select id="issueItem" required>
                        <option value="">Select an item</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issueType">Type</label>
                    <select id="issueType" required>
                        <option value="lost">Lost</option>
                        <option value="damaged">Damaged</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issueQuantity">Quantity</label>
                    <input type="number" id="issueQuantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="issueRoom">Room Number</label>
                    <select id="issueRoom" required>
                        <option value="">Select a room</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-block">Submit Report</button>
            </form>
        </div>
    </div>

    <script>
        // Check if user is logged in
        let token = localStorage.getItem('token');
        let userRole = localStorage.getItem('role');
        let userId = localStorage.getItem('userId'); // We'll need to store user ID
        let currentRoomId = null;

        if (!token || userRole !== 'staff') {
            window.location.href = '/';
        }

        // Helper to get auth headers
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };
        }

        // Generic fetch helper
        async function apiFetch(url, options = {}) {
            const fullUrl = url.startsWith('http') ? url : `http://localhost:3000${url}`;
            const response = await fetch(fullUrl, {
                ...options,
                headers: {
                    ...getAuthHeaders(),
                    ...options.headers
                }
            });

            if (!response.ok) {
                if (response.status === 401 || response.status === 403) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('role');
                    token = null;
                    userRole = null;
                    window.location.href = '/';
                    throw new Error(`API error: ${response.status}`);
                }
                throw new Error(`API error: ${response.status}`);
            }

            return response.json();
        }

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('role');
            window.location.href = '/';
        });

        // Tab switching functionality
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and content
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button
                button.classList.add('active');
                
                // Show corresponding content
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Bottom navigation functionality
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remove active class from all items
                document.querySelectorAll('.nav-item').forEach(navItem => navItem.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked item
                item.classList.add('active');
                
                // Show corresponding content
                const tabId = item.getAttribute('data-tab');
                document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Close modal functionality
        document.getElementById('closeChecklistModal').addEventListener('click', () => {
            document.getElementById('checklistModal').style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('checklistModal')) {
                document.getElementById('checklistModal').style.display = 'none';
            }
        });

        // Show cleaning checklist modal
        function showChecklist(roomId, roomNumber) {
            currentRoomId = roomId;
            document.getElementById('checklistRoomNumber').textContent = roomNumber;
            document.getElementById('checklistModal').style.display = 'flex';
            
            // Reset form
            document.getElementById('checklistForm').reset();
            document.querySelectorAll('.checklist-item').forEach(item => {
                item.classList.remove('completed');
            });
        }

        // Update date display
        function updateDateDisplay() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        // Load housekeeping tasks for My Tasks tab
        async function loadHousekeepingTasks() {
            try {
                const tasks = await apiFetch('/housekeeping-tasks');
                
                // Filter tasks assigned to current user
                const myTasks = tasks.filter(task => task.maid_id == userId);
                
                // Update summary cards
                document.getElementById('roomsToClean').textContent = myTasks.length;
                
                // For now, we'll set these to 0, but in a real app these would be tracked
                document.getElementById('inProgress').textContent = '0';
                document.getElementById('completed').textContent = '0';
                
                // Populate tasks table
                const tasksTableBody = document.querySelector('#housekeepingTasksTable tbody');
                tasksTableBody.innerHTML = '';
                
                myTasks.forEach(task => {
                    const row = tasksTableBody.insertRow();
                    row.insertCell(0).textContent = task.room_name;
                    row.insertCell(1).textContent = task.status;
                    row.insertCell(2).textContent = new Date(task.assigned_date).toLocaleString();
                    row.insertCell(3).textContent = task.notes || 'No notes';
                    
                    // Add action buttons based on status
                    const actionCell = row.insertCell(4);
                    if (task.status === 'assigned') {
                        const startBtn = document.createElement('button');
                        startBtn.textContent = 'Start Cleaning';
                        startBtn.className = 'status-btn status-cleaning';
                        startBtn.onclick = () => updateTaskStatus(task.id, 'in_progress');
                        actionCell.appendChild(startBtn);
                    } else if (task.status === 'in_progress') {
                        const completeBtn = document.createElement('button');
                        completeBtn.textContent = 'Mark Complete';
                        completeBtn.className = 'status-btn status-ready';
                        completeBtn.onclick = () => updateTaskStatus(task.id, 'completed');
                        actionCell.appendChild(completeBtn);
                    }
                });
                
                // Load other dirty rooms (not assigned to anyone)
                loadDirtyRooms();
            } catch (err) {
                console.error('Error loading housekeeping tasks:', err);
                alert('Failed to load tasks. Please refresh.');
            }
        }
        
        // Load dirty rooms for My Tasks tab
        async function loadDirtyRooms() {
            try {
                const rooms = await apiFetch('/rooms');
                
                // Filter rooms that need cleaning (dirty rooms) and are not assigned to any maid
                const dirtyRooms = rooms.filter(room => room.housekeeping_state === 'dirty');
                
                // Populate room list
                const roomListEl = document.getElementById('roomList');
                roomListEl.innerHTML = '';
                
                dirtyRooms.forEach(room => {
                    const roomItem = document.createElement('div');
                    roomItem.className = 'room-item';
                    roomItem.innerHTML = `
                        <div class="room-info">
                            <div class="room-number">${room.name}</div>
                            <div class="guest-status">${room.status === 'occupied' ? 'Check-out' : 'Stay-over'}</div>
                        </div>
                        <div>
                            <span class="priority-badge priority-high">High</span>
                        </div>
                        <div class="status-toggle">
                            <button class="status-btn status-dirty" onclick="updateRoomStatus(${room.id}, 'dirty')">Dirty</button>
                            <button class="status-btn status-cleaning" onclick="updateRoomStatus(${room.id}, 'cleaning')">Cleaning</button>
                            <button class="status-btn status-ready" onclick="updateRoomStatus(${room.id}, 'clean')">Ready</button>
                            <button class="checklist-btn" onclick="showChecklist(${room.id}, '${room.name}')">Checklist</button>
                        </div>
                    `;
                    roomListEl.appendChild(roomItem);
                });
                
                // Populate room dropdown for issues form
                const issueRoomSelect = document.getElementById('issueRoom');
                issueRoomSelect.innerHTML = '<option value="">Select a room</option>';
                rooms.forEach(room => {
                    const option = document.createElement('option');
                    option.value = room.id;
                    option.textContent = room.name;
                    issueRoomSelect.appendChild(option);
                });
            } catch (err) {
                console.error('Error loading dirty rooms:', err);
                alert('Failed to load rooms. Please refresh.');
            }
        }

        // Update room status
        async function updateRoomStatus(roomId, status) {
            try {
                await apiFetch(`/rooms/${roomId}/housekeeping`, {
                    method: 'POST',
                    body: JSON.stringify({ housekeeping_state: status })
                });
                
                // Reload rooms to update the display
                loadRooms();
                
                // Update summary cards based on status
                const roomsToCleanEl = document.getElementById('roomsToClean');
                const inProgressEl = document.getElementById('inProgress');
                const completedEl = document.getElementById('completed');
                
                if (status === 'dirty') {
                    roomsToCleanEl.textContent = parseInt(roomsToCleanEl.textContent) + 1;
                } else if (status === 'cleaning') {
                    inProgressEl.textContent = parseInt(inProgressEl.textContent) + 1;
                } else if (status === 'clean') {
                    completedEl.textContent = parseInt(completedEl.textContent) + 1;
                }
            } catch (err) {
                console.error('Error updating room status:', err);
                alert('Failed to update room status.');
            }
        }

        // Submit cleaning checklist
        document.getElementById('checklistForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentRoomId) {
                alert('No room selected');
                return;
            }
            
            try {
                // Update room status to clean
                await apiFetch(`/rooms/${currentRoomId}/housekeeping`, {
                    method: 'POST',
                    body: JSON.stringify({ housekeeping_state: 'clean' })
                });
                
                // Close modal
                document.getElementById('checklistModal').style.display = 'none';
                
                // Reload rooms to update the display
                loadRooms();
                
                // Update summary cards
                const roomsToCleanEl = document.getElementById('roomsToClean');
                const completedEl = document.getElementById('completed');
                roomsToCleanEl.textContent = parseInt(roomsToCleanEl.textContent) - 1;
                completedEl.textContent = parseInt(completedEl.textContent) + 1;
                
                alert('Room marked as ready!');
            } catch (err) {
                console.error('Error submitting checklist:', err);
                alert('Failed to submit checklist.');
            }
        });

        // Report issue form submission
        document.getElementById('issueForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const roomId = document.getElementById('issueRoom').value;
            const description = document.getElementById('issueDescription').value;
            
            if (!roomId || !description) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                // In a real app, you would send this to the server
                // For now, we'll just show a success message
                alert('Issue reported to manager successfully!');
                document.getElementById('issueForm').reset();
                
                // Update issues reported count
                const issuesReportedEl = document.getElementById('issuesReported');
                issuesReportedEl.textContent = parseInt(issuesReportedEl.textContent) + 1;
            } catch (err) {
                console.error('Error reporting issue:', err);
                alert('Failed to report issue.');
            }
        });

        // Request supply
        async function requestSupply(supplyType) {
            let item = '';
            let reason = '';
            
            switch(supplyType) {
                case 'towels':
                    item = 'Towels';
                    reason = 'Need more towels for guest rooms';
                    break;
                case 'soap':
                    item = 'Soap Bars';
                    reason = 'Need more soap for guest rooms';
                    break;
                case 'cleaning':
                    item = 'Cleaning Supplies';
                    reason = 'Need cleaning supplies for housekeeping';
                    break;
                default:
                    item = supplyType;
                    reason = 'General supply request';
            }
            
            try {
                const response = await apiFetch('/supply-requests', {
                    method: 'POST',
                    body: JSON.stringify({ item_name: item, quantity: 1, reason })
                });
                
                alert(`Request for ${item} sent to manager.`);
                loadSupplyRequests(); // Refresh the supply requests table
            } catch (err) {
                console.error('Error requesting supply:', err);
                alert('Failed to request supplies.');
            }
        }
        
        // Load supply items for dropdown
        async function loadSupplyItems() {
            try {
                // In a real implementation, this would fetch from the server
                // For now, we'll populate with sample items
                const supplyItems = [
                    'Towels',
                    'Soap Bars',
                    'Toilet Paper',
                    'Bed Linens',
                    'Cleaning Supplies',
                    'Trash Bags',
                    'Room Freshener'
                ];
                
                const supplyItemSelect = document.getElementById('supplyItem');
                supplyItemSelect.innerHTML = '<option value="">Select an item</option>';
                
                supplyItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item;
                    option.textContent = item;
                    supplyItemSelect.appendChild(option);
                });
            } catch (err) {
                console.error('Error loading supply items:', err);
            }
        }
        
        // Submit supply request form
        document.getElementById('supplyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const item = document.getElementById('supplyItem').value;
            const quantity = document.getElementById('supplyQuantity').value;
            const reason = document.getElementById('supplyReason').value;
            
            if (!item || !quantity) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const response = await apiFetch('/supply-requests', {
                    method: 'POST',
                    body: JSON.stringify({ item_name: item, quantity: parseInt(quantity), reason })
                });
                
                alert(`Request for ${quantity} ${item} sent to manager.`);
                document.getElementById('supplyForm').reset();
                loadSupplyRequests(); // Refresh the supply requests table
            } catch (err) {
                console.error('Error submitting supply request:', err);
                alert('Failed to submit supply request.');
            }
        });
        
        // Load supply requests for the table
        async function loadSupplyRequests() {
            try {
                const requests = await apiFetch('/supply-requests');
                const tableBody = document.querySelector('#supplyRequestsTable tbody');
                tableBody.innerHTML = '';
                
                requests.forEach(request => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = request.item_name;
                    row.insertCell(1).textContent = request.quantity;
                    row.insertCell(2).textContent = request.reason || 'No reason provided';
                    row.insertCell(3).textContent = request.status;
                    row.insertCell(4).textContent = new Date(request.request_date).toLocaleString();
                });
            } catch (err) {
                console.error('Error loading supply requests:', err);
            }
        }
        
        // Show notification
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = '#007bff';
            notification.style.color = 'white';
            notification.style.padding = '15px';
            notification.style.borderRadius = '5px';
            notification.style.zIndex = '9999';
            notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            
            // Add to document
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Poll for updates (simulating real-time notifications)
        function startRealTimeUpdates() {
            setInterval(async () => {
                try {
                    // Check for new tasks
                    const tasks = await apiFetch('/housekeeping-tasks');
                    const myTasks = tasks.filter(task => task.maid_id == userId);
                    
                    // Check if there are new assigned tasks
                    const assignedTasks = myTasks.filter(task => task.status === 'assigned');
                    if (assignedTasks.length > 0) {
                        showNotification(`You have ${assignedTasks.length} new cleaning task(s)!`);
                    }
                } catch (err) {
                    console.error('Error checking for updates:', err);
                }
            }, 30000); // Check every 30 seconds
        }
        
        // Update housekeeping task status
        async function updateTaskStatus(taskId, status) {
            try {
                await apiFetch(`/housekeeping-tasks/${taskId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status })
                });
                
                alert('Task status updated successfully!');
                loadHousekeepingTasks(); // Refresh the tasks table
            } catch (err) {
                console.error('Error updating task status:', err);
                alert('Failed to update task status.');
            }
        }

        // Clock in/out functionality
        document.getElementById('clockInBtn').addEventListener('click', () => {
            alert('Clocked in successfully!');
            // In a real app, you would send this to the server
        });

        document.getElementById('clockOutBtn').addEventListener('click', () => {
            alert('Clocked out successfully!');
            // In a real app, you would send this to the server
        });

        // Initialize checklist items
        function initChecklistItems() {
            const checklistItems = document.querySelectorAll('.checklist-item input');
            checklistItems.forEach(item => {
                item.addEventListener('change', function() {
                    const parent = this.parentElement;
                    if (this.checked) {
                        parent.classList.add('completed');
                    } else {
                        parent.classList.remove('completed');
                    }
                });
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            updateDateDisplay();
            loadRooms();
            loadSupplyItems();
            initChecklistItems();
            
            // Set up checklist items
            const checklistItems = document.querySelectorAll('.checklist-item input');
            checklistItems.forEach(item => {
                item.addEventListener('change', function() {
                    const parent = this.parentElement;
                    if (this.checked) {
                        parent.classList.add('completed');
                    } else {
                        parent.classList.remove('completed');
                    }
                });
            });
        });
    </script>
</body>
</html>